(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3681],{56693:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/crms/invoices",function(){return s(23466)}])},23466:function(e,t,s){"use strict";s.r(t);var i=s(85893),n=s(67294),a=s(67836),l=s(80562),r=s(73812),d=s(31538),o=s(29630),c=s(21448),m=s(79072),u=s(49837),h=s(59742),x=s(91359),j=s(55343),Z=s(58316),p=s(53442),f=s(61953),g=s(75084),D=s(1890),v=s(77745),y=s(95398),C=s(9041),P=s(44373),Y=s(76779),I=s(17288),w=s(21609),M=s(98966),b=s(9198),A=s.n(b),N=s(46437),_=s(76627),W=s.n(_),S=s(94314),k=s(30381),z=s.n(k),T=s(5464),E=s(86501),F=s(42298);let O=(0,n.forwardRef)((e,t)=>{let s=null!==e.start?(0,F.default)(e.start,"MM/dd/yyyy"):"",n=null!==e.end?" - ".concat((0,F.default)(e.end,"MM/dd/yyyy")):null,l="".concat(s).concat(null!==n?n:"");null===e.start&&e.dates.length&&e.setDates&&e.setDates([]);let r={...e};return delete r.setDates,(0,i.jsx)(a.Z,{fullWidth:!0,inputRef:t,...r,label:e.label||"",value:l})}),H=e=>{let{invoice:t,editInvoice:s,removeInvoice:a}=e,[o,c]=(0,n.useState)(null),m=Boolean(o),u=e=>{e.stopPropagation(),c(e.currentTarget)},h=()=>{c(null)},x=()=>{s(t),h()},j=()=>{a(t._id),h()};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.Z,{size:"small",onClick:u,children:(0,i.jsx)(w.Z,{icon:"mdi:dots-vertical"})}),(0,i.jsxs)(r.Z,{keepMounted:!0,anchorEl:o,open:m,onClose:h,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{style:{minWidth:"8rem"}},children:[(0,i.jsxs)(d.Z,{onClick:x,sx:{"& svg":{mr:2}},children:[(0,i.jsx)(w.Z,{icon:"mdi:pencil",fontSize:20}),"Edit"]}),(0,i.jsxs)(d.Z,{onClick:j,sx:{"& svg":{mr:2}},children:[(0,i.jsx)(w.Z,{icon:"mdi:delete-outline",fontSize:20}),"Delete"]})]})]})},R=()=>{var e;let[t,s]=(0,n.useState)([]),[r,b]=(0,n.useState)(null),[_,S]=(0,n.useState)(null),[k,F]=(0,n.useState)(""),[R,U]=(0,n.useState)(""),[$,L]=(0,n.useState)(!1),[X,B]=(0,n.useState)(10),[q,G]=(0,n.useState)([]),[J,K]=(0,n.useState)(!1),[Q,V]=(0,n.useState)(!1),[ee,et]=(0,n.useState)([]),[es,ei]=(0,n.useState)([]),[en,ea]=(0,n.useState)(0),{user:el}=(0,I.a)(),[er,ed]=(0,n.useState)({agent:"",issuedDate:"",dueDate:"",items:[],description:""});(0,n.useEffect)(()=>{let e=async()=>{let{data:e}=await T.Z.get("crms/invoices/get-agents",{params:{search:""}});et(e)};e()},[]),(0,n.useEffect)(()=>{let e=async()=>{let{data:e}=await T.Z.get("crms/invoices",{params:{id:el._id,role:el.role,isPaid:""!==k?k:null,startDate:null!==r?z()(r).format("YYYY-MM-DD"):null,endDate:null!==_?z()(_).format("YYYY-MM-DD"):null,search:R}});G(e)};e()},[$,k,t,R]);let eo=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;"agent"===e?(ei(ee.find(e=>e._id===t).applications),ed({...er,agent:t})):"item.id"===e?ed({...er,items:er.items.map((e,i)=>{if(s===i){let n=es.find(e=>e._id===t);e.id=t,e.amount=n.amount}return e})}):"item.amount"===e?ed({...er,items:er.items.map((e,i)=>(s===i&&(e.amount=t),e))}):ed({...er,[e]:t})},ec=()=>{ed({...er,items:[...er.items,{id:"",amount:0}]})},em=e=>{ed({...er,items:er.items.filter((t,s)=>s!==e)})},eu=()=>{let e=0;return er.items.forEach(t=>{e+=Number(t.amount)}),e},eh=()=>{ed({agent:"",issuedDate:"",dueDate:"",items:[],description:""}),K(!0)},ex=async e=>{if(e.preventDefault(),""===er.agent)E.Am.error("Please choose an agent to send an invoice.");else if(""===er.issuedDate)E.Am.error("Please choose an issued date.");else if(""===er.dueDate)E.Am.error("Please choose an due date.");else if(er.dueDate<=er.issuedDate)E.Am.error("The due date must be after the issued date.");else if(0===er.items.length)E.Am.error("Please choose items.");else if(-1!==er.items.findIndex(e=>""===e.id))E.Am.error("Please choose item.");else{let{data:t}=await T.Z.post("crms/invoices",{agent:er.agent,issuedDate:er.issuedDate,dueDate:er.dueDate,amount:eu(),applications:er.items.map(e=>e.id),description:er.description});t.status?(K(!1),L(!$),E.Am.success(t.msg)):E.Am.error(t.msg)}},ej=async e=>{ei(ee.find(t=>t._id===e.agent._id).applications),ed({agent:e.agent._id,issuedDate:new Date(e.issuedDate),dueDate:new Date(e.dueDate),items:e.applications.map(e=>({id:e._id,amount:e.amount})),description:e.description}),ea(e._id),V(!0)},eZ=async e=>{if(e.preventDefault(),""===er.agent)E.Am.error("Please choose an agent to send an invoice.");else if(""===er.issuedDate)E.Am.error("Please choose an issued date.");else if(""===er.dueDate)E.Am.error("Please choose an due date.");else if(er.dueDate<=er.issuedDate)E.Am.error("The due date must be after the issued date.");else if(0===er.items.length)E.Am.error("Please choose items.");else if(-1!==er.items.findIndex(e=>""===e.id))E.Am.error("Please choose item.");else{let{data:t}=await T.Z.put("crms/invoices/".concat(en),{agent:er.agent,issuedDate:er.issuedDate,dueDate:er.dueDate,amount:eu(),applications:er.items.map(e=>e.id),description:er.description});t.status?(V(!1),L(!$),E.Am.success(t.msg)):E.Am.error(t.msg)}},ep=async e=>{let{data:t}=await T.Z.delete("crms/invoices/".concat(e));t.status?(L($),E.Am.success(t.msg)):E.Am.error(t.msg)},ef=e=>{let[t,i]=e;null!==t&&null!==i&&s(e),b(t),S(i)};return(0,i.jsxs)(N.Z,{children:[(0,i.jsxs)(m.ZP,{container:!0,spacing:6,children:[(0,i.jsx)(m.ZP,{item:!0,xs:12,children:(0,i.jsxs)(u.Z,{children:[(0,i.jsx)(h.Z,{title:"Filters"}),(0,i.jsx)(x.Z,{children:(0,i.jsxs)(m.ZP,{container:!0,spacing:6,children:[(0,i.jsx)(m.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsxs)(j.Z,{fullWidth:!0,children:[(0,i.jsx)(Z.Z,{children:"Invoice status"}),(0,i.jsxs)(p.Z,{fullWidth:!0,value:k,label:"Invoice status",onChange:e=>F(e.target.value),children:[(0,i.jsx)(d.Z,{value:"",children:"None"}),(0,i.jsx)(d.Z,{value:"unpaid",children:"Unpaid"}),(0,i.jsx)(d.Z,{value:"paid",children:"Paid"})]})]})}),(0,i.jsx)(m.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(A(),{isClearable:!0,selectsRange:!0,monthsShown:2,endDate:_,selected:r,startDate:r,shouldCloseOnSelect:!1,dateFormat:"dd/MM/yyyy",onChange:ef,customInput:(0,i.jsx)(O,{dates:t,setDates:s,label:"Invoice date",end:_,start:r})})})]})})]})}),(0,i.jsx)(m.ZP,{item:!0,xs:12,children:(0,i.jsxs)(u.Z,{children:[(0,i.jsxs)(f.Z,{sx:{p:5,pb:3,width:"100%",display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"flex-end"},children:[(0,i.jsx)(a.Z,{size:"small",value:R,placeholder:"Search invoice",sx:{mr:4,mb:2,maxWidth:180},onChange:e=>U(e.target.value)}),(0,i.jsx)(g.Z,{sx:{mb:2},variant:"contained",onClick:eh,children:"Create invoice"})]}),(0,i.jsx)(M._,{autoHeight:!0,pagination:!0,getRowId:e=>e._id,rows:q,columns:[{flex:3,field:"_id",headerName:"Id",renderCell(e){let{row:t}=e;return(0,i.jsx)(o.Z,{children:t._id})}},{flex:2,field:"firstName",headerName:"First name",renderCell(e){let{row:t}=e;return(0,i.jsx)(o.Z,{children:t.agent.firstName})}},{flex:2,field:"lastName",headerName:"Last name",renderCell(e){let{row:t}=e;return(0,i.jsx)(o.Z,{children:t.agent.lastName})}},{flex:2,field:"amount",headerName:"Total amount",renderCell(t){let{row:s}=t;return(0,i.jsxs)(o.Z,{children:["$",null!==(e=s.amount)&&void 0!==e?e:0]})}},{flex:3,field:"issuedDate",headerName:"Issued date",renderCell(e){let{row:t}=e;return(0,i.jsx)(o.Z,{children:z()(t.issuedDate).format("YYYY-MM-DD")})}},{flex:3,field:"dueDate",headerName:"Due date",renderCell(e){let{row:t}=e;return(0,i.jsx)(o.Z,{children:z()(t.dueDate).format("YYYY-MM-DD")})}},{flex:2,field:"status",headerName:"Status",renderCell(e){let{row:t}=e;return(0,i.jsx)(c.Z,{size:"small",label:t.status.toUpperCase(),color:"unpaid"===t.status?"error":"success"})}},{flex:1,field:"actions",headerName:"Actions",renderCell(e){let{row:t}=e;return(0,i.jsx)(H,{invoice:t,editInvoice:ej,removeInvoice:ep})}}],pageSize:Number(X),rowsPerPageOptions:[10,25,50],onPageSizeChange:e=>B(e)})]})})]}),(0,i.jsxs)(D.Z,{fullWidth:!0,maxWidth:"md",onClose:()=>K(!1),open:J,children:[(0,i.jsxs)(v.Z,{children:["New Invoice",(0,i.jsx)(l.Z,{onClick:()=>K(!1),sx:{position:"absolute",right:18,top:18,color:"#aaaaaa"},children:(0,i.jsx)(w.Z,{icon:"mdi:close"})})]}),(0,i.jsxs)("form",{onSubmit:ex,children:[(0,i.jsx)(y.Z,{sx:{minHeight:400},children:(0,i.jsx)(N.Z,{children:(0,i.jsxs)(m.ZP,{container:!0,spacing:6,children:[(0,i.jsx)(m.ZP,{item:!0,sm:12,children:(0,i.jsxs)(j.Z,{fullWidth:!0,children:[(0,i.jsx)(Z.Z,{children:"Invoice to"}),(0,i.jsxs)(p.Z,{fullWidth:!0,value:er.agent,onChange:e=>eo("agent",e.target.value),label:"Invoice to",children:[(0,i.jsx)(d.Z,{value:"",children:"None"}),ee.map((e,t)=>(0,i.jsxs)(d.Z,{value:e._id,children:[e.firstName," ",e.lastName]},t))]})]})}),(0,i.jsx)(m.ZP,{item:!0,md:6,sm:12,children:(0,i.jsx)(A(),{showYearDropdown:!0,showMonthDropdown:!0,selected:er.issuedDate,dateFormat:"dd/MM/yyyy",placeholderText:"DD/MM/YYYY",onChange:e=>eo("issuedDate",e),customInput:(0,i.jsx)(W(),{mask:"99/99/9999",value:er.issuedDate,children:e=>(0,i.jsx)(a.Z,{fullWidth:!0,label:"Date issued",InputProps:{startAdornment:(0,i.jsx)(C.Z,{position:"start",children:(0,i.jsx)(w.Z,{icon:"mdi:calendar-month"})})},...e})})})}),(0,i.jsx)(m.ZP,{item:!0,md:6,sm:12,children:(0,i.jsx)(A(),{showYearDropdown:!0,showMonthDropdown:!0,selected:er.dueDate,dateFormat:"dd/MM/yyyy",placeholderText:"DD/MM/YYYY",onChange:e=>eo("dueDate",e),customInput:(0,i.jsx)(W(),{mask:"99/99/9999",value:er.dueDate,children:e=>(0,i.jsx)(a.Z,{fullWidth:!0,label:"Date due",InputProps:{startAdornment:(0,i.jsx)(C.Z,{position:"start",children:(0,i.jsx)(w.Z,{icon:"mdi:calendar-month"})})},...e})})})}),(0,i.jsxs)(m.ZP,{item:!0,md:12,sm:12,children:[(0,i.jsx)(g.Z,{size:"sm",sx:{mb:5},variant:"contained",startIcon:(0,i.jsx)(w.Z,{icon:"mdi:plus"}),onClick:ec,children:"Add Item"}),er.items.map((e,t)=>(0,i.jsxs)(m.ZP,{container:!0,spacing:6,sx:{mb:4},children:[(0,i.jsx)(m.ZP,{item:!0,md:8,sm:12,children:(0,i.jsxs)(j.Z,{fullWidth:!0,children:[(0,i.jsx)(Z.Z,{children:"Item"}),(0,i.jsxs)(p.Z,{fullWidth:!0,value:e.id,label:"Item",onChange:e=>eo("item.id",e.target.value,t),children:[(0,i.jsx)(d.Z,{children:"None"}),es.map((e,t)=>(0,i.jsxs)(d.Z,{value:e._id,children:["Application - ",z()(e.createdAt).format("YYYY/MM/DD HH:mm:ss")]},t))]})]})}),(0,i.jsx)(m.ZP,{item:!0,md:3,sm:12,children:(0,i.jsx)(j.Z,{fullWidth:!0,children:(0,i.jsx)(a.Z,{fullWidth:!0,label:"Amount",readOnly:!0,value:e.amount})})}),(0,i.jsx)(m.ZP,{item:!0,md:1,sm:12,sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(l.Z,{size:"small",color:"error",onClick:()=>em(t),children:(0,i.jsx)(w.Z,{icon:"mdi:close",fontSize:20})})})]},t)),(0,i.jsx)(P.Z,{}),(0,i.jsx)(f.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,i.jsxs)(o.Z,{variant:"h6",children:["Total Amount: $",eu()]})}),(0,i.jsx)(P.Z,{}),(0,i.jsx)(j.Z,{fullWidth:!0,sx:{mt:3},children:(0,i.jsx)(a.Z,{label:"Description",value:er.description,onChange:e=>eo("description",e.target.value),multiline:!0,rows:6})})]})]})})}),(0,i.jsxs)(Y.Z,{children:[(0,i.jsx)(g.Z,{size:"large",variant:"contained",color:"primary",startIcon:(0,i.jsx)(w.Z,{icon:"mdi:content-save"}),type:"submit",children:"Create"}),(0,i.jsx)(g.Z,{size:"large",variant:"contained",color:"error",startIcon:(0,i.jsx)(w.Z,{icon:"mdi:close"}),onClick:()=>K(!1),children:"Cancel"})]})]})]}),(0,i.jsxs)(D.Z,{fullWidth:!0,maxWidth:"md",onClose:()=>V(!1),open:Q,children:[(0,i.jsxs)(v.Z,{children:["Edit Invoice",(0,i.jsx)(l.Z,{onClick:()=>V(!1),sx:{position:"absolute",right:18,top:18,color:"#aaaaaa"},children:(0,i.jsx)(w.Z,{icon:"mdi:close"})})]}),(0,i.jsxs)("form",{onSubmit:eZ,children:[(0,i.jsx)(y.Z,{sx:{minHeight:400},children:(0,i.jsx)(N.Z,{children:(0,i.jsxs)(m.ZP,{container:!0,spacing:6,children:[(0,i.jsx)(m.ZP,{item:!0,sm:12,children:(0,i.jsxs)(j.Z,{fullWidth:!0,children:[(0,i.jsx)(Z.Z,{children:"Invoice to"}),(0,i.jsxs)(p.Z,{fullWidth:!0,value:er.agent,onChange:e=>eo("agent",e.target.value),label:"Invoice to",children:[(0,i.jsx)(d.Z,{value:"",children:"None"}),ee.map((e,t)=>(0,i.jsxs)(d.Z,{value:e._id,children:[e.firstName," ",e.lastName]},t))]})]})}),(0,i.jsx)(m.ZP,{item:!0,md:6,sm:12,children:(0,i.jsx)(A(),{showYearDropdown:!0,showMonthDropdown:!0,selected:er.issuedDate,dateFormat:"dd/MM/yyyy",placeholderText:"DD/MM/YYYY",onChange:e=>eo("issuedDate",e),customInput:(0,i.jsx)(W(),{mask:"99/99/9999",value:er.issuedDate,children:e=>(0,i.jsx)(a.Z,{fullWidth:!0,label:"Date issued",InputProps:{startAdornment:(0,i.jsx)(C.Z,{position:"start",children:(0,i.jsx)(w.Z,{icon:"mdi:calendar-month"})})},...e})})})}),(0,i.jsx)(m.ZP,{item:!0,md:6,sm:12,children:(0,i.jsx)(A(),{showYearDropdown:!0,showMonthDropdown:!0,selected:er.dueDate,dateFormat:"dd/MM/yyyy",placeholderText:"DD/MM/YYYY",onChange:e=>eo("dueDate",e),customInput:(0,i.jsx)(W(),{mask:"99/99/9999",value:er.dueDate,children:e=>(0,i.jsx)(a.Z,{fullWidth:!0,label:"Date due",InputProps:{startAdornment:(0,i.jsx)(C.Z,{position:"start",children:(0,i.jsx)(w.Z,{icon:"mdi:calendar-month"})})},...e})})})}),(0,i.jsxs)(m.ZP,{item:!0,md:12,sm:12,children:[(0,i.jsx)(g.Z,{size:"sm",sx:{mb:5},variant:"contained",startIcon:(0,i.jsx)(w.Z,{icon:"mdi:plus"}),onClick:ec,children:"Add Item"}),er.items.map((e,t)=>(0,i.jsxs)(m.ZP,{container:!0,spacing:6,sx:{mb:4},children:[(0,i.jsx)(m.ZP,{item:!0,md:8,sm:12,children:(0,i.jsxs)(j.Z,{fullWidth:!0,children:[(0,i.jsx)(Z.Z,{children:"Item"}),(0,i.jsxs)(p.Z,{fullWidth:!0,value:e.id,label:"Item",onChange:e=>eo("item.id",e.target.value,t),children:[(0,i.jsx)(d.Z,{children:"None"}),es.map((e,t)=>(0,i.jsxs)(d.Z,{value:e._id,children:["Application - ",z()(e.createdAt).format("YYYY/MM/DD HH:mm:ss")]},t))]})]})}),(0,i.jsx)(m.ZP,{item:!0,md:3,sm:12,children:(0,i.jsx)(j.Z,{fullWidth:!0,children:(0,i.jsx)(a.Z,{fullWidth:!0,label:"Amount",readOnly:!0,value:e.amount})})}),(0,i.jsx)(m.ZP,{item:!0,md:1,sm:12,sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(l.Z,{size:"small",color:"error",onClick:()=>em(t),children:(0,i.jsx)(w.Z,{icon:"mdi:close",fontSize:20})})})]},t)),(0,i.jsx)(P.Z,{}),(0,i.jsx)(f.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,i.jsxs)(o.Z,{variant:"h6",children:["Total Amount: $",eu()]})}),(0,i.jsx)(P.Z,{}),(0,i.jsx)(j.Z,{fullWidth:!0,sx:{mt:3},children:(0,i.jsx)(a.Z,{label:"Description",value:er.description,onChange:e=>eo("description",e.target.value),multiline:!0,rows:6})})]})]})})}),(0,i.jsxs)(Y.Z,{children:[(0,i.jsx)(g.Z,{size:"large",variant:"contained",color:"primary",startIcon:(0,i.jsx)(w.Z,{icon:"mdi:content-save"}),type:"submit",children:"Update"}),(0,i.jsx)(g.Z,{size:"large",variant:"contained",color:"error",startIcon:(0,i.jsx)(w.Z,{icon:"mdi:close"}),onClick:()=>V(!1),children:"Cancel"})]})]})]})]})};R.getLayout=e=>(0,i.jsx)(S.Z,{children:e}),t.default=R}},function(e){e.O(0,[4885,6284,8480,4583,8515,8259,7836,9072,9317,7985,8960,7554,4314,6437,9774,2888,179],function(){return e(e.s=56693)}),_N_E=e.O()}]);