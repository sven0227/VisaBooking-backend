(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7247],{57704:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/crms/announcements",function(){return t(43279)}])},43279:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return H}});var l=t(85893),r=t(67294),s=t(17288),i=t(80562),o=t(73812),a=t(31538),c=t(29630),d=t(21448),x=t(79072),u=t(49837),m=t(59742),h=t(61953),j=t(75084),Z=t(91359),f=t(21609),p=t(98966),g=t(94314),C=t(1890),y=t(77745),v=t(95398),b=t(55343),w=t(67836),S=t(5464),_=t(86501);let k=e=>{let{show:n,announcement:t,init:o,onInit:a,onClose:c}=e,{user:d}=(0,s.a)(),[x,u]=(0,r.useState)({title:"",content:""});return(0,r.useEffect)(()=>{let e=async()=>{if(Object.keys(t).length){let{data:e}=await S.Z.get("crms/announcements/".concat(t._id),{params:{userId:d._id}});a(!o),u(e)}};e()},[t]),(0,l.jsxs)(C.Z,{fullWidth:!0,maxWidth:"md",onClose:c,open:n,children:[(0,l.jsxs)(y.Z,{children:["Announcement Detail",(0,l.jsx)(i.Z,{onClick:c,sx:{position:"absolute",right:18,top:18,color:"#aaa"},children:(0,l.jsx)(f.Z,{icon:"mdi:close"})})]}),(0,l.jsxs)(v.Z,{sx:{p:6},children:[(0,l.jsx)(b.Z,{fullWidth:!0,sx:{mt:3,mb:6},children:(0,l.jsx)(w.Z,{value:x.title,label:"Title",readOnly:!0})}),(0,l.jsx)(b.Z,{fullWidth:!0,sx:{mb:6},children:(0,l.jsx)(w.Z,{value:x.content,multiline:!0,rows:8,label:"Content",readOnly:!0})}),(0,l.jsx)(h.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,l.jsx)(j.Z,{variant:"contained",color:"error",size:"large",startIcon:(0,l.jsx)(f.Z,{icon:"mdi:close"}),onClick:c,children:"Close"})})]})]})};var A=t(32631),N=t(58316),I=t(53442),z=t(74231),W=t(47533),E=t(87536);let T=e=>{let{show:n,init:t,onInit:s,onClose:o}=e,c=z.Ry().shape({title:z.Z_().required(),content:z.Z_().required()}),{reset:d,control:x,handleSubmit:u,formState:{errors:m}}=(0,E.cI)({defaultValues:{title:"",content:"",type:"agent"},mode:"onChange",resolver:(0,W.X)(c)});(0,r.useEffect)(()=>{d()},[]);let Z=async e=>{let{data:n}=await S.Z.post("crms/announcements",e);n.status?(_.Am.success(n.msg),s(!t),o()):_.Am.error(n.msg)};return(0,l.jsxs)(C.Z,{fullWidth:!0,maxWidth:"md",onClose:o,open:n,children:[(0,l.jsxs)(y.Z,{children:["New Announcement",(0,l.jsx)(i.Z,{onClick:o,sx:{position:"absolute",right:18,top:18,color:"#aaa"},children:(0,l.jsx)(f.Z,{icon:"mdi:close"})})]}),(0,l.jsx)(v.Z,{sx:{p:6},children:(0,l.jsxs)("form",{onSubmit:u(Z),style:{paddingTop:8},children:[(0,l.jsxs)(b.Z,{fullWidth:!0,sx:{mb:6},children:[(0,l.jsx)(E.Qr,{name:"title",control:x,render(e){let{field:{value:n,onChange:t}}=e;return(0,l.jsx)(w.Z,{value:n,label:"Title",onChange:t,error:Boolean(m.title)})}}),m.title&&(0,l.jsx)(A.Z,{sx:{color:"error.main"},children:m.title.message})]}),(0,l.jsxs)(b.Z,{fullWidth:!0,sx:{mb:6},children:[(0,l.jsx)(E.Qr,{name:"content",control:x,render(e){let{field:{value:n,onChange:t}}=e;return(0,l.jsx)(w.Z,{value:n,multiline:!0,rows:8,label:"Content",onChange:t,error:Boolean(m.content)})}}),m.content&&(0,l.jsx)(A.Z,{sx:{color:"error.main"},children:m.content})]}),(0,l.jsxs)(b.Z,{fullWidth:!0,sx:{mb:6},children:[(0,l.jsx)(N.Z,{error:Boolean(m.type),htmlFor:"type",children:"Type"}),(0,l.jsx)(E.Qr,{name:"type",id:"type",control:x,render(e){let{field:{value:n,onChange:t}}=e;return(0,l.jsxs)(I.Z,{value:n,label:"Type",onChange:t,error:Boolean(m.type),children:[(0,l.jsx)(a.Z,{value:"agent",children:"Agent"}),(0,l.jsx)(a.Z,{value:"staff",children:"Staff"})]})}})]}),(0,l.jsxs)(h.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:[(0,l.jsx)(j.Z,{type:"submit",variant:"contained",color:"primary",size:"large",startIcon:(0,l.jsx)(f.Z,{icon:"mdi:content-save"}),sx:{mr:4},children:"Save"}),(0,l.jsx)(j.Z,{variant:"contained",color:"error",size:"large",startIcon:(0,l.jsx)(f.Z,{icon:"mdi:delete"}),onClick:o,children:"Cancel"})]})]})})]})},Y=e=>{let{show:n,announcement:t,init:s,onInit:o,onClose:a}=e,[c,d]=(0,r.useState)(0);(0,r.useEffect)(()=>{d(t._id),u({title:t.title,content:t.content})},[t]);let x=z.Ry().shape({title:z.Z_().required(),content:z.Z_().required()}),{reset:u,control:m,handleSubmit:Z,formState:{errors:p}}=(0,E.cI)({defaultValues:{title:"",content:""},mode:"onChange",resolver:(0,W.X)(x)}),g=async e=>{let{data:n}=await S.Z.put("crms/announcements/".concat(c),e);n.status?(o(!s),a(),_.Am.success(n.msg)):_.Am.error(n.msg)};return(0,l.jsxs)(C.Z,{fullWidth:!0,maxWidth:"md",onClose:a,open:n,children:[(0,l.jsxs)(y.Z,{children:["Edit Announcement",(0,l.jsx)(i.Z,{onClick:a,sx:{position:"absolute",right:18,top:18,color:"#aaa"},children:(0,l.jsx)(f.Z,{icon:"mdi:close"})})]}),(0,l.jsx)(v.Z,{sx:{p:6},children:(0,l.jsxs)("form",{onSubmit:Z(g),style:{paddingTop:8},children:[(0,l.jsxs)(b.Z,{fullWidth:!0,sx:{mb:6},children:[(0,l.jsx)(E.Qr,{name:"title",control:m,render(e){let{field:{value:n,onChange:t}}=e;return(0,l.jsx)(w.Z,{value:n,label:"Title",onChange:t,error:Boolean(p.title)})}}),p.title&&(0,l.jsx)(A.Z,{sx:{color:"error.main"},children:p.title.message})]}),(0,l.jsxs)(b.Z,{fullWidth:!0,sx:{mb:6},children:[(0,l.jsx)(E.Qr,{name:"content",control:m,render(e){let{field:{value:n,onChange:t}}=e;return(0,l.jsx)(w.Z,{value:n,multiline:!0,rows:8,label:"Content",onChange:t,error:Boolean(p.content)})}}),p.content&&(0,l.jsx)(A.Z,{sx:{color:"error.main"},children:p.content})]}),(0,l.jsxs)(h.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:[(0,l.jsx)(j.Z,{type:"submit",variant:"contained",color:"primary",size:"large",startIcon:(0,l.jsx)(f.Z,{icon:"mdi:content-save"}),sx:{mr:4},children:"Update"}),(0,l.jsx)(j.Z,{variant:"contained",color:"error",size:"large",startIcon:(0,l.jsx)(f.Z,{icon:"mdi:delete"}),onClick:a,children:"Cancel"})]})]})})]})};var B=t(30381),D=t.n(B);t(56701);let O=e=>{let{row:n,onEdit:t,onDelete:s}=e,[c,d]=(0,r.useState)(null),x=Boolean(c),u=e=>{d(e.currentTarget)},m=()=>{d(null)},h=()=>{t(n),m()},j=()=>{s(n._id),m()};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.Z,{size:"small",onClick:u,children:(0,l.jsx)(f.Z,{icon:"mdi:dots-vertical"})}),(0,l.jsxs)(o.Z,{keepMounted:!0,anchorEl:c,open:x,onClose:m,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{style:{minWidth:"8rem"}},children:[(0,l.jsxs)(a.Z,{sx:{"& svg":{mr:2}},onClick:h,children:[(0,l.jsx)(f.Z,{icon:"mdi:pencil-outline",fontSize:20})," Edit"]}),(0,l.jsxs)(a.Z,{sx:{"& svg":{mr:2}},onClick:j,children:[(0,l.jsx)(f.Z,{icon:"mdi:delete-outline",fontSize:20})," Delete"]})]})]})},P=()=>{let{user:e}=(0,s.a)(),[n,t]=(0,r.useState)(!0),[i,o]=(0,r.useState)(""),[a,g]=(0,r.useState)(10),[C,y]=(0,r.useState)([]),[v,b]=(0,r.useState)(!1),[w,A]=(0,r.useState)(!1),[N,I]=(0,r.useState)(!1),[z,W]=(0,r.useState)({}),[E,B]=(0,r.useState)([]);(0,r.useEffect)(()=>{let n=async()=>{let{data:n}=await S.Z.get("crms/announcements",{params:{userId:e._id,search:i}});y(n)};n(),"super_admin"===e.role||"admin"===e.role?B([{flex:4,field:"title",headerName:"Title",renderCell(e){let{row:n}=e;return(0,l.jsx)(c.Z,{children:n.title})}},{flex:6,field:"content",headerName:"Content",renderCell(e){let{row:n}=e;return(0,l.jsx)(c.Z,{children:n.content})}},{flex:2,field:"createdAt",headerName:"Sent date",renderCell(e){let{row:n}=e;return(0,l.jsx)(c.Z,{children:D()(n.createdAt).format("YYYY.MM.DD HH:mm:ss")})}},{flex:1,field:"action",headerName:"Action",renderCell(e){let{row:n}=e;return(0,l.jsx)(O,{row:n,onEdit:H,onDelete:M})}}]):B([{flex:4,field:"title",headerName:"Title",renderCell(e){let{row:n}=e;return(0,l.jsx)(c.Z,{children:n.title})}},{flex:6,field:"content",headerName:"Content",renderCell(e){let{row:n}=e;return(0,l.jsx)(c.Z,{children:n.content})}},{flex:2,field:"createdAt",headerName:"Sent date",renderCell(e){let{row:n}=e;return(0,l.jsx)(c.Z,{children:D()(n.createdAt).format("YYYY.MM.DD HH:mm:ss")})}},{flex:1,field:"status",headerName:"Status",renderCell(e){let{row:n}=e;return(0,l.jsx)(d.Z,{skin:"light",size:"small",variant:"filled",color:n.users.length?"success":"error",label:n.users.length?"Read":"New"})}}])},[n]);let P=async e=>{let{row:n}=e;W(n),b(!0)},H=async e=>{W(e),I(!0)},M=async e=>{let{data:l}=await S.Z.delete("crms/announcements/".concat(e));l.status?(_.Am.success(l.msg),t(!n)):_.Am.error(l.msg)};return(0,l.jsx)(x.ZP,{container:!0,spacing:6,children:(0,l.jsx)(x.ZP,{item:!0,xs:12,children:(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(m.Z,{title:(0,l.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(c.Z,{variant:"h5",children:"Announcements"}),("super_admin"===e.role||"admin"===e.role)&&(0,l.jsx)(j.Z,{variant:"contained",size:"small",startIcon:(0,l.jsx)(f.Z,{icon:"mdi:plus"}),onClick:()=>A(!0),children:"Add New"})]})}),(0,l.jsxs)(Z.Z,{children:[(0,l.jsx)(h.Z,{children:(0,l.jsx)(p._,{autoHeight:!0,getRowId:e=>e._id,columns:E,rows:C,onRowClick:P,pageSize:a,onPageSizeChange:e=>g(e)})}),(0,l.jsx)(T,{show:w,init:n,onInit:t,onClose:()=>A(!1)}),(0,l.jsx)(Y,{show:N,announcement:z,init:n,onInit:t,onClose:()=>I(!1)}),(0,l.jsx)(k,{show:v,announcement:z,init:n,onInit:t,onClose:()=>b(!1)})]})]})})})};P.getLayout=e=>(0,l.jsx)(g.Z,{children:e});var H=P}},function(e){e.O(0,[4885,6284,8480,4583,8515,8259,7836,9072,9491,9317,7985,4314,9774,2888,179],function(){return e(e.s=57704)}),_N_E=e.O()}]);